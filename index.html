<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>
        <style>
          .map {
            opacity: 0.5;
            position: absolute;
            transform: rotate(12deg);
            margin-top: -70px;
            margin-left: -110px;
          }
        </style>
    </head>
    <body>
        <img src="centralpark.jpg" width="1050" height="500" class="map"></img>
        <svg width="800" height="300" id="parkMap" style="position:absolute"></svg>

        <script>
            let svg=d3.select("#parkMap")
            let width=svg.width;
            let height=svg.height;
            console.log(width);
            console.log(height);

            let squirrelDataArea=svg.append("g").attr("id", "squirrelDataArea")
            let parkMapArea=svg.append("g").attr("id", "parkMapArea")
            let annotationsArea=svg.append("g").attr("id", "annotationsArea")



            const mapSquirrels = async function(){
                const squirrelData=await d3.csv("squirrelData.csv", d3.autoType);
                console.log(squirrelData);

                let xExtent=d3.extent(squirrelData, d=>d["X"]);
                let yExtent=d3.extent(squirrelData, d=>d["Y"]);


                let xScale=d3.scaleLinear().domain(xExtent).range([0,800]);
                let yScale=d3.scaleLinear().domain(yExtent).range([300,0]);
                console.log(squirrelData[0]['X']);
                squirrelData.category = "Activities";
                squirrelData.forEach((d, i) => {
                  if (d["Running"] == true) {
                    d["Activities"] = 1;
                  } else if (d["Chasing"] == true) {
                    d["Activities"] = 2;
                  } else if (d["Climbing"] ==true) {
                    d["Activities"] = 3;
                  } else if (d["Eating"] == true) {
                    d["Activities"] = 4;
                  } else if (d["Foraging"] == true) {
                    d["Activities"] = 5;
                  } else if (d["Other Activities"] != null) {
                    d["Activities"] = 6;
                  } else {
                    d["Activities"] = 0;
                  }
                });
                var colors = d3.scaleQuantize().domain([0, 6]).range(["#5E4FA2", "#EC7063", "#229954", "#273746", "#b7950b",
                "#5DADE2", "#707B7C"]);
                squirrelDataArea.selectAll("circle.squirrelCircle").data(squirrelData)
                    .join('circle')
                    .attr("r", "3")
                    .attr("fill", d=>colors(d["Activities"]))
                    .attr("class","squirrelCircle")
                    .attr("cx", d=>xScale(d['X']))
                    .attr("cy", d=>yScale(d['Y']))
                    .attr("opacity", "2");
                var keys = ["Running", "Chasing", "Climbing", "Eating", "Foraging", "Other Activities"]
                var keyColor = d3.scaleOrdinal().domain(keys).range(["#5E4FA2", "#EC7063", "#229954", "#273746", "#b7950b",
                "#5DADE2", "#707B7C"]);
                svg.selectAll("dots").data(keys)
                  .enter()
                  .append("circle")
                    .attr("cx", 20)
                    .attr("cy", function(d,i){ return 20 + i * 25})
                    .attr("r", 7)
                    .style("fill", d => keyColor(d))
                svg.selectAll("labels")
                  .data(keys)
                  .enter()
                  .append("text")
                    .attr("x", 30)
                    .attr("y", function(d,i){return 25 + i * 25})
                    .style("fill", d => keyColor(d))
                    .text(function(d){return d})

            }
            mapSquirrels();
        </script>
    </body>
</html>
